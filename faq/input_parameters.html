<!DOCTYPE html>

<html class="writer-html5" data-content_root="../" lang="en">
<head>
<meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Instantiating Input Parameters — xibs 0.6.0 documentation</title>
<link href="../_static/pygments.css?v=fa44fd50" rel="stylesheet" type="text/css"/>
<link href="../_static/css/theme.css?v=19f00094" rel="stylesheet" type="text/css"/>
<link href="../_static/copybutton.css?v=76b2166b" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-codeautolink.css?v=125d5c1c" rel="stylesheet" type="text/css"/>
<link href="../_static/sg_gallery.css?v=61a4c737" rel="stylesheet" type="text/css"/>
<link href="../_static/sg_gallery-binder.css?v=f4aeca0c" rel="stylesheet" type="text/css"/>
<link href="../_static/sg_gallery-dataframe.css?v=2082cf3c" rel="stylesheet" type="text/css"/>
<link href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-dropdown.css?v=995e94df" rel="stylesheet" type="text/css"/>
<link href="../_static/panels-bootstrap.min.css?v=21c0b90a" rel="stylesheet" type="text/css"/>
<link href="../_static/css/custom.css?v=0a86e678" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
<script src="../_static/jquery.js?v=5d32c60e"></script>
<script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
<script src="../_static/documentation_options.js?v=8fa8b3e9"></script>
<script src="../_static/doctools.js?v=888ff710"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script src="../_static/clipboard.min.js?v=a7894cd8"></script>
<script src="../_static/copybutton.js?v=f281be69"></script>
<script src="../_static/js/theme.js"></script>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="emittance_types.html" rel="next" title="Emittances: Geometric or Normalized"/>
<link href="index.html" rel="prev" title="Frequently Asked Questions"/>
</head>
<body class="wy-body-for-nav">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a href="../index.html">
</a>
<div class="version">
                0.6.0
              </div>
<div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input aria-label="Search docs" name="q" placeholder="Search docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div><div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#integration-with-xsuite">Integration with xsuite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#formalism-and-models">Formalism and Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#analytical-calculations">Analytical Calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#providing-kicks-to-particle-distributions">Providing Kicks to Particle Distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#formalism-dispatch">Formalism Dispatch</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Gallery</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../gallery/demo_analytical_bjorken_mtingwa_emittances.html">Bjorken-Mtingwa Formalism - Analytical Growth Rates and Emittance Evolution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_analytical_bjorken_mtingwa_emittances.html#setting-up-line-and-particles">Setting up line and particles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_analytical_bjorken_mtingwa_emittances.html#computing-ibs-growth-rates">Computing IBS Growth Rates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_analytical_bjorken_mtingwa_emittances.html#computing-new-emittances-from-growth-rates">Computing New Emittances from Growth Rates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_analytical_bjorken_mtingwa_emittances.html#analytical-evolution-for-a-time-period">Analytical Evolution for a Time Period</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../gallery/demo_compare_analyticals.html">Comparison of Analytical IBS Growth Rates and Emittances Evolution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_compare_analyticals.html#comparing-analytical-evolution-for-a-time-period">Comparing Analytical Evolution for a Time Period</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../gallery/demo_analytical_nagaitsev_emittances.html">Nagaitsev Formalism - Analytical Growth Rates and Emittance Evolution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_analytical_nagaitsev_emittances.html#setting-up-line-and-particles">Setting up line and particles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_analytical_nagaitsev_emittances.html#computing-elliptic-integrals-and-ibs-growth-rates">Computing Elliptic Integrals and IBS Growth Rates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_analytical_nagaitsev_emittances.html#computing-new-emittances-from-growth-rates">Computing New Emittances from Growth Rates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_analytical_nagaitsev_emittances.html#analytical-evolution-for-many-turns">Analytical Evolution for Many Turns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../gallery/demo_simple_kicks.html">Simple Kicks Formalism - IBS Kicks Based on Analytical Growth Rates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_simple_kicks.html#setting-up-line-and-particles">Setting up line and particles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_simple_kicks.html#generating-the-ibs-kick-class">Generating the IBS Kick Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_simple_kicks.html#computing-and-applying-ibs-kicks">Computing and Applying IBS Kicks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gallery/demo_simple_kicks.html#applying-ibs-kicks-in-tracking">Applying IBS Kicks in Tracking</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#input-data-structures">Input Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#formalism-dispatch">Formalism Dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#ibs-analytical-calculations">IBS: Analytical Calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#ibs-applying-kicks">IBS: Applying Kicks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#formulary">Formulary</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Frequently Asked Questions</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Instantiating Input Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#opticsparameters-from-an-xtrack-line">OpticsParameters from an <code class="xref py py-obj docutils literal notranslate"><span class="pre">xtrack.Line</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#opticsparameters-from-mad-x">OpticsParameters from <code class="docutils literal notranslate"><span class="pre">MAD-X</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#do-i-need-a-full-matched-particle-distribution-for-beamparameters">Do I need a full matched particle distribution for <code class="xref py py-obj docutils literal notranslate"><span class="pre">BeamParameters</span></code>?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beamparameters-from-an-xtrack-line">BeamParameters from an <code class="xref py py-obj docutils literal notranslate"><span class="pre">xtrack.Line</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#beamparameters-from-mad-x">BeamParameters from <code class="docutils literal notranslate"><span class="pre">MAD-X</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="emittance_types.html">Emittances: Geometric or Normalized</a></li>
<li class="toctree-l2"><a class="reference internal" href="radiation.html">Synchrotron Radiation Contribution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="radiation.html#getting-sr-parameters-from-xsuite">Getting SR Parameters from Xsuite</a></li>
<li class="toctree-l3"><a class="reference internal" href="radiation.html#getting-sr-parameters-from-mad-x">Getting SR Parameters from MAD-X</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="coasting_beams.html">Bunched and Coasting Beams</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Reference Bibliography</a></li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"><nav aria-label="Mobile navigation menu" class="wy-nav-top">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="../index.html">xibs</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="Page navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a aria-label="Home" class="icon icon-home" href="../index.html"></a></li>
<li class="breadcrumb-item"><a href="index.html">Frequently Asked Questions</a></li>
<li class="breadcrumb-item active">Instantiating Input Parameters</li>
<li class="wy-breadcrumbs-aside">
<!-- User defined GitHub URL -->
<a class="fa fa-github" href="https://github.com/fsoubelet/xibs"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<section id="instantiating-input-parameters">
<span id="xibs-faq-inputparams"></span><h1>Instantiating Input Parameters<a class="headerlink" href="#instantiating-input-parameters" title="Link to this heading"></a></h1>
<p>All classes in this package are instantiated from an <code class="xref py py-obj docutils literal notranslate"><span class="pre">OpticsParameters</span></code> and a <code class="xref py py-obj docutils literal notranslate"><span class="pre">BeamsParameters</span></code> object.
This section compiles a few common questions about each, starting with the former.</p>
<section id="opticsparameters-from-an-xtrack-line">
<span id="xibs-faq-optics-params-from-line"></span><h2>OpticsParameters from an <code class="xref py py-obj docutils literal notranslate"><span class="pre">xtrack.Line</span></code><a class="headerlink" href="#opticsparameters-from-an-xtrack-line" title="Link to this heading"></a></h2>
<p>The default mode to instantiate an <code class="xref py py-obj docutils literal notranslate"><span class="pre">OpticsParameters</span></code> is from the <code class="xref py py-obj docutils literal notranslate"><span class="pre">TwissTable</span></code> returned by an <code class="xref py py-obj docutils literal notranslate"><span class="pre">xtrack.Line.twiss</span></code> call.
All necessary attributes of the class are automatically filled or computed from the <code class="xref py py-obj docutils literal notranslate"><span class="pre">TwissTable</span></code> object.
It goes very simply as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let's assume your `xtrack.Line` is already defined</span>
<span class="n">twiss</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">twiss</span><span class="p">(</span><span class="n">particle_ref</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
<span class="n">optics_params</span> <span class="o">=</span> <span class="n">OpticsParameters</span><span class="p">(</span><span class="n">twiss</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">xibs</span></code> version 0.3.0, there is a convenience method to do the above automatically for the user.
It is documented in the <a class="reference internal" href="../modules/index.html#xibs-inputs"><span class="std std-ref">API reference</span></a>.
It goes according to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let's assume your `xtrack.Line` is already defined</span>
<span class="n">optics_params</span> <span class="o">=</span> <span class="n">OpticsParameters</span><span class="o">.</span><span class="n">from_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="opticsparameters-from-mad-x">
<span id="xibs-faq-optics-params-from-madx"></span><h2>OpticsParameters from <code class="docutils literal notranslate"><span class="pre">MAD-X</span></code><a class="headerlink" href="#opticsparameters-from-mad-x" title="Link to this heading"></a></h2>
<p>For those using for instance <code class="docutils literal notranslate"><span class="pre">MAD-X</span></code> and looking to only use the analytical calculations of <code class="docutils literal notranslate"><span class="pre">xibs</span></code> without setting up a whole <code class="xref py py-obj docutils literal notranslate"><span class="pre">xtrack.Line</span></code>, it is possible to instantiate the <code class="xref py py-obj docutils literal notranslate"><span class="pre">OpticsParameters</span></code> from a <code class="docutils literal notranslate"><span class="pre">MAD-X</span></code> <code class="xref py py-obj docutils literal notranslate"><span class="pre">twiss</span></code> result.</p>
<p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">twiss</span></code> result is expected in the form of a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.2.0)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> with all lowercase columns and values, as given by <code class="xref py py-obj docutils literal notranslate"><span class="pre">cpymad</span></code>.
Some additional attributes not present in <code class="docutils literal notranslate"><span class="pre">MAD-X</span></code>’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">twiss</span></code> result are expected to be provided at instantiation time, namely the revolution frequency and slip factor.
These quantities can be computed from <code class="docutils literal notranslate"><span class="pre">MAD-X</span></code> after a <code class="xref py py-obj docutils literal notranslate"><span class="pre">twiss</span></code>, as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let's assume your `cpymad.madx.Madx` instance is already defined</span>
<span class="n">twiss</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">twiss</span><span class="p">(</span><span class="n">centre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dframe</span><span class="p">()</span>  <span class="c1"># you want a Twiss at element centers</span>
<span class="n">seq_name</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">twiss</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">sequence</span>  <span class="c1"># works whichever your sequence</span>

<span class="c1"># Compute additional required parameters: revolution frequency and slip factor</span>
<span class="n">frev_hz</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="n">seq_name</span><span class="p">]</span><span class="o">.</span><span class="n">beam</span><span class="o">.</span><span class="n">freq0</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># beware freq0 is in MHz</span>
<span class="n">gamma_rel</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="n">seq_name</span><span class="p">]</span><span class="o">.</span><span class="n">beam</span><span class="o">.</span><span class="n">gamma</span>  <span class="c1"># relativistic gamma</span>
<span class="n">gamma_tr</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">summ</span><span class="o">.</span><span class="n">gammatr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># transition gamma</span>
<span class="n">slipfactor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">gamma_tr</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">gamma_rel</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># use the xsuite convention!</span>

<span class="c1"># And these have to be provided as additional arguments</span>
<span class="n">optics_params</span> <span class="o">=</span> <span class="n">OpticsParameters</span><span class="p">(</span><span class="n">twiss</span><span class="p">,</span> <span class="n">slipfactor</span><span class="p">,</span> <span class="n">frev_hz</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">xibs</span></code> version 0.3.0, there is a convenience method to do the above automatically for the user.
It is documented in the <a class="reference internal" href="../modules/index.html#xibs-inputs"><span class="std std-ref">API reference</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let's assume your `cpymad.madx.Madx` instance is already defined</span>
<span class="n">optics_params</span> <span class="o">=</span> <span class="n">OpticsParameters</span><span class="o">.</span><span class="n">from_madx</span><span class="p">(</span><span class="n">madx</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="do-i-need-a-full-matched-particle-distribution-for-beamparameters">
<span id="xibs-faq-beam-params-from-particle-ref"></span><h2>Do I need a full matched particle distribution for <code class="xref py py-obj docutils literal notranslate"><span class="pre">BeamParameters</span></code>?<a class="headerlink" href="#do-i-need-a-full-matched-particle-distribution-for-beamparameters" title="Link to this heading"></a></h2>
<p>One might have noticed, for example in the <a class="reference internal" href="../gallery/demo_analytical_bjorken_mtingwa_emittances.html#demo-analytical-bjorken-mtingwa"><span class="std std-ref">Bjorken-Mtingwa</span></a> or <a class="reference internal" href="../gallery/demo_analytical_nagaitsev_emittances.html#demo-analytical-nagaitsev"><span class="std std-ref">Nagaitsev</span></a> analytical examples, that the latter is instantiated from a fully matched <code class="xref py py-obj docutils literal notranslate"><span class="pre">xpart.Particles</span></code> distribution.
Creating a matched distribution is an intensive step and requires parameters one might not want to be annoyed providing.</p>
<p>It is possible to bypass this step and use for instance the <code class="xref py py-obj docutils literal notranslate"><span class="pre">xtrack.Line</span></code>’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">particle_ref</span></code> instead.
However, in several computations the Coulomb logarithm is necessary, which is heavily dependent on the number of particles in the distribution, a value not reflected by the reference particle object.</p>
<p>When instantiating from a single particle this value will be wrong and should be manually set afterwards.
This would go as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xpart</span> <span class="k">as</span> <span class="nn">xp</span>
<span class="kn">from</span> <span class="nn">xibs.inputs</span> <span class="kn">import</span> <span class="n">BeamParameters</span>

<span class="c1"># Let's define what one would use as "reference particle" for the line and use that</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">Particles</span><span class="p">(</span><span class="n">p0c</span><span class="o">=</span><span class="mf">6500e9</span><span class="p">,</span> <span class="n">q0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mass0</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">PROTON_MASS_EV</span><span class="p">)</span>
<span class="n">beam_params</span> <span class="o">=</span> <span class="n">BeamParameters</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>

<span class="c1"># Now you have to manually set the "true" value for '.n_part'</span>
<span class="n">beam_parameters</span><span class="o">.</span><span class="n">n_part</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#int" title="int"><span class="nb">int</span></a><span class="p">(</span><span class="mf">5e5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="beamparameters-from-an-xtrack-line">
<span id="xibs-faq-beam-params-from-line"></span><h2>BeamParameters from an <code class="xref py py-obj docutils literal notranslate"><span class="pre">xtrack.Line</span></code><a class="headerlink" href="#beamparameters-from-an-xtrack-line" title="Link to this heading"></a></h2>
<p>The default mode to instantiate a <code class="xref py py-obj docutils literal notranslate"><span class="pre">BeamParameters</span></code> is from an <code class="xref py py-obj docutils literal notranslate"><span class="pre">xpart.Particles</span></code> object.
As seen just above, it is possible to use an <code class="xref py py-obj docutils literal notranslate"><span class="pre">xtrack.Line</span></code>’s reference particle to do so.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">xibs</span></code> version 0.3.0, there is a convenience method to do the above automatically for the user.
It is documented in the <a class="reference internal" href="../modules/index.html#xibs-inputs"><span class="std std-ref">API reference</span></a>.
It goes according to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let's assume your `xtrack.Line` is already defined</span>
<span class="n">beam_params</span> <span class="o">=</span> <span class="n">BeamParameters</span><span class="o">.</span><span class="n">from_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">n_part</span><span class="o">=</span><span class="mf">5e5</span><span class="p">)</span>  <span class="c1"># need to provide n_part</span>
</pre></div>
</div>
</div>
</section>
<section id="beamparameters-from-mad-x">
<span id="xibs-faq-beam-params-from-madx"></span><h2>BeamParameters from <code class="docutils literal notranslate"><span class="pre">MAD-X</span></code><a class="headerlink" href="#beamparameters-from-mad-x" title="Link to this heading"></a></h2>
<p>It is also possible to query the <code class="xref py py-obj docutils literal notranslate"><span class="pre">beam</span></code> in use for the currently active sequence from <code class="docutils literal notranslate"><span class="pre">MAD-X</span></code> to get the desired parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let's assume your `cpymad.madx.Madx` instance is already defined</span>
<span class="n">madx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">twiss</span><span class="p">()</span>  <span class="c1"># want the table to determine the sequence name and access its beam</span>
<span class="n">seq_name</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">twiss</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">sequence</span>  <span class="c1"># will give us the active sequence</span>

<span class="c1"># Query required parameters from the beam: particle momentum, particle charge,</span>
<span class="c1"># particle rest mass and number of particles in the bunch</span>
<span class="n">p0c_eV</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="n">seq_name</span><span class="p">]</span><span class="o">.</span><span class="n">beam</span><span class="o">.</span><span class="n">pc</span> <span class="o">*</span> <span class="mf">1e9</span>  <span class="c1"># in [GeV] in MAD-X beam, but we want [eV]</span>
<span class="n">q0</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="n">seq_name</span><span class="p">]</span><span class="o">.</span><span class="n">beam</span><span class="o">.</span><span class="n">charge</span>  <span class="c1"># electrical particle charge in units of [qp]</span>
<span class="n">mass0</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="n">seq_name</span><span class="p">]</span><span class="o">.</span><span class="n">beam</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="mf">1e9</span>  <span class="c1"># rest mass in [eV] | but in [GeV] in MAD-X</span>
<span class="n">npart</span> <span class="o">=</span> <span class="n">madx</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="n">seq_name</span><span class="p">]</span><span class="o">.</span><span class="n">beam</span><span class="o">.</span><span class="n">npart</span>  <span class="c1"># number of particles</span>

<span class="c1"># Create an xpart.Particles object with this information</span>
<span class="n">particle</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">Particles</span><span class="p">(</span><span class="n">p0c</span><span class="o">=</span><span class="n">p0c_eV</span><span class="p">,</span> <span class="n">q0</span><span class="o">=</span><span class="n">q0</span><span class="p">,</span> <span class="n">mass0</span><span class="o">=</span><span class="n">mass0</span><span class="p">)</span>
<span class="n">beam_params</span> <span class="o">=</span> <span class="n">BeamParameters</span><span class="p">(</span><span class="n">particle</span><span class="p">)</span>
<span class="n">beam_params</span><span class="o">.</span><span class="n">n_part</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#int" title="int"><span class="nb">int</span></a><span class="p">(</span><span class="n">npart</span><span class="p">)</span>  <span class="c1"># very important to adjust this!</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">xibs</span></code> version 0.3.0, there is a convenience method to do the above automatically for the user.
It is documented in the <a class="reference internal" href="../modules/index.html#xibs-inputs"><span class="std std-ref">API reference</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let's assume your `cpymad.madx.Madx` instance is already defined</span>
<span class="n">beam_params</span> <span class="o">=</span> <span class="n">BeamParameters</span><span class="o">.</span><span class="n">from_madx</span><span class="p">(</span><span class="n">madx</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
</div>
</div>
<footer><div aria-label="Footer" class="rst-footer-buttons" role="navigation">
<a accesskey="p" class="btn btn-neutral float-left" href="index.html" rel="prev" title="Frequently Asked Questions"><span aria-hidden="true" class="fa fa-arrow-circle-left"></span> Previous</a>
<a accesskey="n" class="btn btn-neutral float-right" href="emittance_types.html" rel="next" title="Emittances: Geometric or Normalized">Next <span aria-hidden="true" class="fa fa-arrow-circle-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<p>© Copyright 2023, Felix Soubelet.</p>
</div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
</div>
</div>
</section>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
</body>
</html>